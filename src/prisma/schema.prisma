// schema.prisma - Versão 2.1.0 - ADD: Suporte para upload local de imagens
// Versão: 2.1.0 - Suporte para upload local de imagens de personagem
// Data: 2024-01-15
// Autor: Sistema RPG

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Character {
  id                                 Int                             @id @default(autoincrement())
  name                               String
  age                                Int?
  gender                             String?
  player_name                        String?
  rpg_system                         String?
  current_hit_points                 Int                             @default(0)
  max_hit_points                     Int                             @default(0)
  current_picture                    Int                             @default(1)
  is_dead                            Boolean                         @default(false)
  
  // ATUALIZADO: Campos de URL de imagem com tamanho maior para uploads locais
  standard_character_picture_url     String?                         @db.Text
  injured_character_picture_url      String?                         @db.Text
  
  stress_level                       Int?                            @default(0)
  trauma_level                       Int?                            @default(0)
  willpower                          Int?                            @default(0)
  experience                         Int?                            @default(0)
  health_squares                     String?                         @default("[]") @db.Text
  stress_squares                     String?                         @default("[]") @db.Text
  created_at                         DateTime                        @default(now())
  atencao_bonus                      Int?                            @default(0)
  atencao_calculado                  Int?                            @default(10)
  current_energy_points              Int?                            @default(0)
  current_soul_integrity             Int?                            @default(0)
  defesa_bonus                       Int?                            @default(0)
  defesa_calculada                   Int?                            @default(10)
  derived_values_bonuses             String?                         @default("{}") @db.Text
  deslocamento_bonus                 Int?                            @default(0)
  deslocamento_calculado             Int?                            @default(9)
  especializacao                     String?
  experiencia                        Int?                            @default(0)
  grau                               String?
  iniciativa_bonus                   Int?                            @default(0)
  iniciativa_calculada               Int?                            @default(0)
  level                              Int?                            @default(1)
  max_energy_points                  Int?                            @default(0)
  multiclasse                        String?
  origem                             String?
  tecnica                            String?
  treino                             String?
  feiticeiros_distribution_completed Boolean                         @default(false)
  feiticeiros_metodo_criacao         String?                         @default("FIXOS")
  equipment_notes                    String?                         @db.Text
  radiation_squares                  String?                         @default("[]") @db.Text
  experience_points                  Int?                            @default(0)
  experience_squares                 String?                         @default("[]") @db.Text
  history_points                     Int?                            @default(0)
  history_squares                    String?                         @default("[]") @db.Text
  appearance                         String?                         @db.Text
  camarada                           String?
  career                             String?
  personal_goal                      String?                         @db.Text
  rival                              String?
  talents                            String?                         @default("[]") @db.Text
  conditions                         String?                         @default("{}") @db.Text
  consumables                        String?                         @default("{}") @db.Text
  emotional_item                     String?                         @db.Text
  injuries                           String?                         @default("[]") @db.Text
  tiny_items                         String?                         @db.Text
  armadura                           String?
  armas                              String?                         @default("[]") @db.Text
  carga_armadura                     String?                         @default("")
  nivel_armadura                     String?                         @default("")
  attributes                         CharacterAttribute[]
  skills                             CharacterSkill[]
  feiticeiros_ataques                FeiticeirosAtaque[]
  feiticeiros_attributes             FeiticeirosCharacterAttribute[]
  feiticeiros_oficios                FeiticeirosOficio[]
  feiticeiros_pericias               FeiticeirosPericia[]
  feiticeiros_resistencias           FeiticeirosResistencia[]
  rolls                              Roll[]
  yearzero_attributes                YearZeroCharacterAttribute[]
  yearzero_skills                    YearZeroCharacterSkill[]

  @@index([name])
  @@index([player_name])
  @@index([rpg_system])
  @@index([created_at])
  @@map("character")
}

model CharacterAttribute {
  character_id Int
  attribute_id Int
  value        Int
  attribute    Attribute @relation(fields: [attribute_id], references: [id], onDelete: Cascade)
  character    Character @relation(fields: [character_id], references: [id], onDelete: Cascade)

  @@id([character_id, attribute_id])
  @@map("character_attributes")
}

model Attribute {
  id          Int                  @id @default(autoincrement())
  name        String               @unique
  description String?
  characters  CharacterAttribute[]

  @@index([name])
  @@map("attribute")
}

model CharacterSkill {
  character_id Int
  skill_id     Int
  value        Int
  character    Character @relation(fields: [character_id], references: [id], onDelete: Cascade)
  skill        Skill     @relation(fields: [skill_id], references: [id], onDelete: Cascade)

  @@id([character_id, skill_id])
  @@map("character_skills")
}

model Skill {
  id          Int              @id @default(autoincrement())
  name        String           @unique
  description String?
  characters  CharacterSkill[]

  @@index([name])
  @@map("skills")
}

model YearZeroCharacterAttribute {
  character_id Int
  attribute_id Int
  value        Int               @default(0)
  attribute    YearZeroAttribute @relation(fields: [attribute_id], references: [id], onDelete: Cascade)
  character    Character         @relation(fields: [character_id], references: [id], onDelete: Cascade)

  @@id([character_id, attribute_id])
  @@map("yearzero_attributes")
}

model YearZeroAttribute {
  id          Int                          @id @default(autoincrement())
  name        String                       @unique
  description String?
  characters  YearZeroCharacterAttribute[]

  @@index([name])
  @@map("yearzero_attribute")
}

model YearZeroCharacterSkill {
  character_id Int
  skill_id     Int
  value        Int           @default(0)
  character    Character     @relation(fields: [character_id], references: [id], onDelete: Cascade)
  skill        YearZeroSkill @relation(fields: [skill_id], references: [id], onDelete: Cascade)

  @@id([character_id, skill_id])
  @@map("yearzero_skills")
}

model YearZeroSkill {
  id          Int                      @id @default(autoincrement())
  name        String                   @unique
  description String?
  characters  YearZeroCharacterSkill[]

  @@index([name])
  @@map("yearzero_skill")
}

model FeiticeirosCharacterAttribute {
  character_id Int
  attribute_id Int
  value        Int                  @default(10)
  attribute    FeiticeirosAttribute @relation(fields: [attribute_id], references: [id], onDelete: Cascade)
  character    Character            @relation(fields: [character_id], references: [id], onDelete: Cascade)

  @@id([character_id, attribute_id])
  @@map("feiticeiros_character_attributes")
}

model FeiticeirosAttribute {
  id          Int                             @id @default(autoincrement())
  name        String                          @unique
  description String?
  base_value  Int                             @default(10)
  characters  FeiticeirosCharacterAttribute[]

  @@index([name])
  @@map("feiticeiros_attribute")
}

model FeiticeirosPericia {
  id           Int       @id @default(autoincrement())
  character_id Int
  nome         String
  atributo     String
  descricao    String?
  treinada     Boolean   @default(false)
  mestre       Boolean   @default(false)
  outros       Int       @default(0)
  character    Character @relation(fields: [character_id], references: [id], onDelete: Cascade)

  @@index([character_id])
  @@map("feiticeiros_pericias")
}

model FeiticeirosOficio {
  id           Int       @id @default(autoincrement())
  character_id Int
  nome         String
  atributo     String
  descricao    String?
  treinada     Boolean   @default(false)
  mestre       Boolean   @default(false)
  outros       Int       @default(0)
  character    Character @relation(fields: [character_id], references: [id], onDelete: Cascade)

  @@index([character_id])
  @@map("feiticeiros_oficios")
}

model FeiticeirosResistencia {
  id           Int       @id @default(autoincrement())
  character_id Int
  nome         String
  atributo     String
  descricao    String?
  treinada     Boolean   @default(false)
  mestre       Boolean   @default(false)
  outros       Int       @default(0)
  character    Character @relation(fields: [character_id], references: [id], onDelete: Cascade)

  @@index([character_id])
  @@map("feiticeiros_resistencias")
}

model FeiticeirosAtaque {
  id           Int       @id @default(autoincrement())
  character_id Int
  nome         String
  atributo     String
  descricao    String?
  treinada     Boolean   @default(false)
  mestre       Boolean   @default(false)
  outros       Int       @default(0)
  character    Character @relation(fields: [character_id], references: [id], onDelete: Cascade)

  @@index([character_id])
  @@map("feiticeiros_ataques")
}

model Roll {
  id            Int       @id @default(autoincrement())
  max_number    Int
  rolled_number Int
  character_id  Int
  rolled_at     DateTime  @default(now())
  character     Character @relation(fields: [character_id], references: [id], onDelete: Cascade)

  @@index([character_id])
  @@index([rolled_at])
  @@map("roll")
}

model Config {
  id    Int     @id @default(autoincrement())
  name  String  @unique
  value String?

  @@index([name])
  @@map("config")
}